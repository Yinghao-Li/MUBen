<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="img/favicon.ico" />
    <title>About - MUBen - Documentation</title>
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "About";
        var mkdocs_page_input_path = "index.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="." class="icon icon-home"> MUBen - Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Introduction</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href=".">About</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#backbones">Backbones</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#uncertainty-quantification-methods">Uncertainty Quantification Methods</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#data">Data</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#experimental-results">Experimental Results</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#ongoing-works-active-learning">Ongoing Works: Active Learning</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#citation">Citation</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="env/">Environment</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="train.cli/">Running Experiments</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="train.python/">Using MUBen Package</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">MUBen API</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="muben.args/">muben.args</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="muben.layers/">muben.layers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="muben.dataset/">muben.dataset</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="muben.train/">muben.train</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="muben.utils/">muben.utils</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Examples</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="customize/">Customization</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href=".">MUBen - Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Introduction</li>
      <li class="breadcrumb-item active">About</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="muben-documentation">MUBen Documentation</h1>
<p><a href="https://github.com/Yinghao-Li/MUBen"><img alt="GitHub" src="https://img.shields.io/badge/GitHub-MUBen-white" /></a>
<a href="https://openreview.net/forum?id=qYceFeHgm4"><img alt="OpenReview" src="https://img.shields.io/badge/%F0%9F%94%97%20OpenReview-TMLR-darkred" /></a>
<a href="https://arxiv.org/abs/2306.10060"><img alt="arXiv" src="https://img.shields.io/badge/arXiv-2306.10060-b31b1b.svg" /></a>
<a href="https://github.com/Yinghao-Li/MUBen/"><img alt="Maintenance" src="https://img.shields.io/badge/Maintained%3F-yes-green.svg" /></a>
<a href="https://badge.fury.io/py/muben"><img alt="PyPI version" src="https://badge.fury.io/py/muben.svg" /></a></p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>This is the documentation for <strong><a href="https://github.com/Yinghao-Li/MUBen/">MUBen</a>: Mulecular Uncertainty Benchmark</strong>.
The code is built to expose implementation details as much as possible and be easily extendable.
Questions and suggestions are welcome if you find any issues while using our code.</p>
</div>
<p><img alt="" src="img/f1.summarization.png" /></p>
<p>MUBen is a benchmark that aims to investigate the performance of uncertainty quantification (UQ) methods built upon backbone molecular representation models.
It implements 6 backbone models (4 pre-trained and 2 non-pre-trained), 8 UQ methods (8 compatible for classification and 6 for regression), and 14 datasets from <a href="https://moleculenet.org/">MoleculeNet</a> (8 for classification and 6 for regression).
We are actively expanding the benchmark to include more backbones, UQ methods and datasets.
This is an arduous task, and we welcome contribution or collaboration in any form.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The following of this page introduces the basic information and structure of the MUBen project.
For its utilization or customization, please visit the <a href="train.cli/">Experiments</a> or <a href="customize/">Customization</a> pages.</p>
</div>
<h2 id="backbones">Backbones</h2>
<p>The following backbone models are implemented in MUBen, and their performance discussed in the published article.</p>
<table>
<thead>
<tr>
<th>Backbone Models</th>
<th>Paper</th>
<th>Official Repo</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><em>Pre-Trained</em></strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>ChemBERTa</td>
<td><a href="https://arxiv.org/abs/2209.01712">link</a></td>
<td><a href="https://github.com/seyonechithrananda/bert-loves-chemistry">link</a></td>
</tr>
<tr>
<td>GROVER</td>
<td><a href="https://arxiv.org/abs/2007.02835">link</a></td>
<td><a href="https://github.com/tencent-ailab/grover">link</a></td>
</tr>
<tr>
<td>Uni-Mol</td>
<td><a href="https://openreview.net/forum?id=6K2RM6wVqKu">link</a></td>
<td><a href="https://github.com/dptech-corp/Uni-Mol/tree/main/unimol">link</a></td>
</tr>
<tr>
<td>TorchMD-NET</td>
<td><a href="https://arxiv.org/abs/2202.02541">Architecture</a>; <a href="https://arxiv.org/abs/2206.00133">Pre-training</a></td>
<td><a href="https://github.com/shehzaidi/pre-training-via-denoising">link</a></td>
</tr>
<tr>
<td><strong><em>Trained from Scratch</em></strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>DNN</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>GIN</td>
<td><a href="https://arxiv.org/pdf/1810.00826.pdf">link</a></td>
<td><a href="https://pytorch-geometric.readthedocs.io/en/latest/generated/torch_geometric.nn.models.GIN.html">pyg</a></td>
</tr>
</tbody>
</table>
<p>MUBen also support easy integration of your own backbone models.
To use your own backbones, please check the <a href="customize/">customization guide</a>.</p>
<h2 id="uncertainty-quantification-methods">Uncertainty Quantification Methods</h2>
<p>Currently, MUBen supports the following uncertainty quantification methods.
Notice that some methods only work with one of the classification/regression task.</p>
<table>
<thead>
<tr>
<th>UQ Method</th>
<th>Classification</th>
<th>Regression</th>
<th>Paper</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><em>Included in Paper</em></strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Deterministic</td>
<td>✅︎</td>
<td>✅︎</td>
<td>-</td>
</tr>
<tr>
<td>Temperature Scaling</td>
<td>✅︎</td>
<td>-</td>
<td><a href="https://arxiv.org/abs/1706.04599">link</a></td>
</tr>
<tr>
<td>Focal Loss</td>
<td>✅︎</td>
<td>-</td>
<td><a href="https://arxiv.org/abs/1708.02002">link</a></td>
</tr>
<tr>
<td>Deep Ensembles</td>
<td>✅︎</td>
<td>✅︎</td>
<td><a href="https://arxiv.org/abs/1612.01474">link</a></td>
</tr>
<tr>
<td>SWAG</td>
<td>✅︎</td>
<td>✅︎</td>
<td><a href="https://arxiv.org/abs/1808.05326">link</a></td>
</tr>
<tr>
<td>Bayes by Backprop</td>
<td>✅︎</td>
<td>✅︎</td>
<td><a href="https://arxiv.org/abs/1505.05424">link</a></td>
</tr>
<tr>
<td>SGLD</td>
<td>✅︎</td>
<td>✅︎</td>
<td><a href="https://www.stats.ox.ac.uk/~teh/research/compstats/WelTeh2011a.pdf">link</a></td>
</tr>
<tr>
<td>MC Dropout</td>
<td>✅︎</td>
<td>✅︎</td>
<td><a href="https://arxiv.org/abs/1506.02142">link</a></td>
</tr>
<tr>
<td><strong><em>Additional in Repo</em></strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Evidential Networks</td>
<td>✅︎</td>
<td>✅︎</td>
<td><a href="https://openreview.net/forum?id=xqS8k9E75c">link</a></td>
</tr>
<tr>
<td>Conformal Prediction</td>
<td>-</td>
<td>✅︎</td>
<td><a href="https://arxiv.org/abs/2107.07511">link</a></td>
</tr>
<tr>
<td>Isotonic Calibration</td>
<td>-</td>
<td>✅︎</td>
<td><a href="https://arxiv.org/abs/1905.06023">link</a></td>
</tr>
</tbody>
</table>
<h2 id="data">Data</h2>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The prepared scaffold-split data is available in the <a href="https://github.com/Yinghao-Li/UncertaintyBenchmark/tree/main/data/files">./data/files/</a> directory on GitHub.</p>
</div>
<p>This documentation utilizes a selection from the MoleculeNet benchmark, which includes datasets such as BBBP, Tox21, ToxCast, SIDER, ClinTox, BACE, MUV, HIV, ESOL, FreeSolv, Lipophilicity, QM7, QM8, and QM9.
For detailed descriptions of these datasets, please refer to the <a href="https://moleculenet.org/datasets-1">MoleculeNet website</a>.</p>
<p>We employ the "molecular property" datasets curated by <a href="https://github.com/dptech-corp/Uni-Mol/tree/main/unimol">Uni-Mol</a>, which are accessible for download <a href="https://bioos-hermite-beijing.tos-cn-beijing.volces.com/unimol_data/finetune/molecular_property_prediction.tar.gz">here</a>.
While the original Uni-Mol dataset is generally not necessary, it is used to provide pre-defined molecule conformations for running the Uni-Mol model.
To use the Uni-Mol data, download and unzip the files into the <code>./data/UniMol/</code> directory.
For ease of reference, you are suggested to rename the <code>qm7dft</code>, <code>qm8dft</code>, and <code>qm9dft</code> directories to <code>qm7</code>, <code>qm8</code>, and <code>qm9</code>, respectively.
The conversion of the dataset format from Uni-Mol to our specifications can be viewed in the script <a href="https://github.com/Yinghao-Li/MUBen/blob/main/assist/dataset_build_from_unimol.py">dataset_build_from_unimol.py</a>.</p>
<p>Typically, each dataset comprises 4 files: <code>train.csv</code>, <code>valid.csv</code>, <code>test.csv</code>, and <code>meta.json</code>.
The <code>.csv</code> files partition the data into training, validation, and testing sets, while <code>meta.json</code> contains metadata such as task type (classification or regression), number of tasks, and number of classes (for classification tasks).
Each <code>.csv</code> file contains three columns:
- <code>smiles</code>: A string representing the SMILES notation of a molecule.
- <code>labels</code>: A list of integers or floats representing the property values to be predicted for each molecule. The length of the list corresponds to the number of tasks.
- <code>masks</code>: A binary list (containing 0s and 1s) where 1 indicates a valid property value and 0 indicates an invalid value to be ignored during training and testing.</p>
<p>The dataset is automatically loaded during training through the method <code>muben.dataset.Dataset.prepare()</code>.
For a practical example, visit the <a href="train.python/">example</a> page.</p>
<h2 id="experimental-results">Experimental Results</h2>
<p>We have made our experimental results available in the <a href="https://github.com/Yinghao-Li/MUBen/tree/main/reports">./reports/</a> directory on GitHub.
These results are organized into different folders based on the nature of the experiments:</p>
<ul>
<li><code>primary</code>: Contains the most comprehensive set of results derived from experiments on scaffold-split datasets.</li>
<li><code>random</code>: Includes results from experiments conducted on datasets that were split randomly.</li>
<li><code>frozen</code>: Features results from experiments where the pre-trained model's weights were frozen, except for the last output layer, which was updatable.</li>
<li><code>distribution</code>: Offers results from the QM9 dataset, where the test set was categorized into five bins based on the average Tanimoto similarities to the training scaffolds.</li>
</ul>
<p>Files within these directories are named following the pattern <code>&lt;backbone&gt;-&lt;dataset&gt;.csv</code>.
Each file provides a comparison of different UQ methods.
The rows detail the performance of each UQ method, while the columns display the mean and standard deviation from three random runs for each metric.</p>
<p>Additional post-processing scripts can be found in the <a href="https://github.com/Yinghao-Li/MUBen/tree/main/assist">./assist/</a> directory, which include files starting with <code>plot_</code> or <code>results_</code>.
These scripts are useful for further analysis and visualization of the experimental data.</p>
<h2 id="ongoing-works-active-learning">Ongoing Works: Active Learning</h2>
<p>We are developing code to integrate <em>active learning</em> into the pipeline.
Specifically, we assume we have a small set of labeled data points (<code>--n_init_instances</code>) at the beginning.
Within each active learning iteration, we use the labeled dataset to fine-tune the model parameters and select a batch of data points (<code>--n_al_select</code>) from the unlabeled set with the least predicted certainty (<em>i.e.</em>, max predicted entropy for classification and max predicted variance for regression).
The process is repeated for several loops (<code>--n_al_loops</code>), and the intermediate performance is tracked.</p>
<p>The code is still under construction and currently is <strong>only available under the <code>dev</code> branch</strong>.
In addition, several points are worth attention:</p>
<ul>
<li>Currently, only DNN and ChemBERTa backbones are supported (<code>./run/dnn_al.py</code> and <code>./run/chemberta_al.py</code>). Migrating AL to other backbones is not difficult but requires updating some Trainer functions if they are reloaded.</li>
<li>To enable active learning, make sure you set <code>--enable_active_learning</code> to <code>true</code>.</li>
<li>Currently, Deep Ensembles is not supported for AL.</li>
<li>We cannot guarantee the correctness of our implementation. If you notice any abnormalities in the code, please do not hesitate to post an issue.</li>
</ul>
<p>One example is</p>
<pre><code class="language-bash">python ./run/dnn_al.py \
  --enable_active_learning \
  --n_init_instances 100 \
  --n_al_loops 20 \
  --n_al_select 20 \
  # other model and training hyper-parameters...
</code></pre>
<h2 id="citation">Citation</h2>
<p>If you find our work helpful, please consider citing it as</p>
<pre><code class="language-latex">@misc{li2023muben,
    title={MUBen: Benchmarking the Uncertainty of Pre-Trained Models for Molecular Property Prediction},
    author={Yinghao Li and Lingkai Kong and Yuanqi Du and Yue Yu and Yuchen Zhuang and Wenhao Mu and Chao Zhang},
    year={2023},
    eprint={2306.10060},
    archivePrefix={arXiv},
    primaryClass={physics.chem-ph}
}
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="env/" class="btn btn-neutral float-right" title="Environment">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
      <span><a href="env/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="js/jquery-3.6.0.min.js"></script>
    <script>var base_url = ".";</script>
    <script src="js/theme_extra.js"></script>
    <script src="js/theme.js"></script>
      <script src="search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
